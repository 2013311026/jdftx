<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>JDFTx: Open-shell systems</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('OpenShell.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Open-shell systems </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="Hatom.png" alt="Hatom.png"/>
</div>
<p>This tutorial covers the basics for spin-polarized and open-shell calculations in JDFTx, using the most basic system of all, a hydrogen atom. Additionally, it introduces the eigenvalue output and the exact-exchange options in the code.</p>
<p>First, lets set up a hydrogen atom calculation exactly as we would based on the previous tutorials. Save the following to Hatom.in:</p>
<pre class="fragment">lattice Cubic 15
ion H 0 0 0  1

coulomb-interaction Isolated
coulomb-truncation-embed 0 0 0

ion-species GBRV/$ID_pbe_v1.2.uspp
ion-species GBRV/$ID_pbe_v1.01.uspp
ion-species GBRV/$ID_pbe_v1.uspp
elec-cutoff 20 100

dump End None
</pre><p>and run jdftx -i Hatom.in. Since there is only one atom, we don't need geometry optimization. Notice that the final energy Etot = -0.45851 Hartrees, which is rather different from the analytical exact energy -0.5 Hartree (= -1 Rydberg = -13.6 eV).</p>
<p>The reason for this disrepancy is that, by default, this DFT calculation is spin-unpolarized, that is it assumes an equal number of up and down spin electrons. This assumption is correct for the water molecule with a closed shell of 8 valence electrons that we dealt with so far, but is incorrect for the hydrogen atom which has only one electron. This electron must be either an up or down spin, so that the magnetization (Nup - Ndn) is +1 or -1. We can invoke a spin-polarized calculation and specify the magnetization using the commands: </p>
<pre class="fragment">spintype z-spin                     #z-spin = up/dn polarization (non-relativistic spin)
elec-initial-magnetization +1 yes   #yes = hold magnetization fixed, no = optimize it
</pre><p>Add these commands to Hatom.in and rerun jdftx. Now we find Etot = -0.4994 Hartrees, in much better agreement with the analytical result. Check that using magnetization -1 produces exactly the same result.</p>
<p>Next, let's examine the Kohn-Sham eigenvalue of the Hydrogen orbitals. Add the following commands to Hatom.in to output the eigenvalues: </p>
<pre class="fragment">dump End BandEigs
dump-name Hatom.$VAR
</pre><p>and rerun jdftx. It will now output a binary file Hatom.eigenvals, whose contents you can examine using one of the distributed scripts: </p>
<pre class="fragment">binaryToText Hatom.eigenvals
</pre><p>Note that the Kohn-Sham eigenvalues for the occupied (spin up) orbital is approximately -0.28 Hartrees, in very poor agreement with the exact analytical result of -0.5 Hartrees. (The unoccupied state eigenvalue does not converge in this variational minimize calculation since it absolutely does not contribute to the total energy. Converging empty state eigenvalues reliably requires a <a href="BandStructure.html">band-structure calculation</a>, or the use of the <a class="el" href="CommandConvergeEmptyStates.html">converge-empty-states</a> command.)</p>
<p>This eigenvalue inaccuracy is a well-known limitation of semi-local DFT approximations such as the default PBE generalized-gradient approximation used here. In these functionals, the electrons effectively interact with themselves (self-interaction error) which makes the Kohn-Sham eigenvalues of occupied states too high, and leads to the well-known underestimation of band gaps of solids. Note however that the total energies are still almost surprisingly accurate.</p>
<p>For the one-electron hydrogen atom, we can eliminate this self-interaction error using Hartree-Fock, which evaluates the exact exchange energy directly from the wavefunctions, instead of approximating it from the density (and omits the correlation density functional). We can specify Hartree-Fock theory using the command: </p>
<pre class="fragment"> elec-ex-corr Hartree-Fock
</pre><p>Running jdftx on Hatom.in with this command added, will at first however fail because exact-exchange based calculations are only supported for norm-conserving pseudopotentials, whereas the GBRV pseudopotentials used above are ultrasoft pseudopotentials. Therefore, additionally replace the two ion-species lines and the elec-cutoff line above with </p>
<pre class="fragment"> ion-species SG15/$ID_ONCV_PBE-1.1.upf
 ion-species SG15/$ID_ONCV_PBE-1.0.upf
 elec-cutoff 30
</pre><p>to use the norm-conserving SG15 pseudopotential set, which requires a higher plane-wave cutoff. Now run jdftx again (it will take around ten times as long) and examine the eigenvalues using binaryToText. Now we find that the eigenvalue of the occupied state is -0.4998 Hartrees, exactly equal to the total energy Etot = -0.4998 Hartrees, both in very good agreement with the analytical result of -0.5 Hartrees.</p>
<p>The Hartree-Fock calculations are exact for the hydrogen atom, but are much less accurate than semi-local DFTs for most molecules and solids, especially for calculating total energies and geometries. A common practice to empirically get the best of both worlds is to mix a fraction of exact exchange into a semi-local DFT calculation. For example, to use the popular PBE0 or HSE06 functionals in JDFTx, you would specify the hyb-PBE0 or hyb-HSE06 options to elec-ex-corr. In this special case however, we find that the eigenvalues for those (-0.336 and -0.329 respectively) are closer to the semi-local DFT result, than to the exact Hartree-Fock result. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
