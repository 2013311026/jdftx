<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>JDFTx: Setting up molecule geometries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('CoulombTrunc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Setting up molecule geometries </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="CoulombTruncation.png" alt="CoulombTruncation.png"/>
</div>
<p>The previous tutorial showed a water molecule calculation in a cubic box of side 10 bohrs. JDFTx is a plane-wave DFT code, which means that it naturally incorporates periodic boundary conditions. However, for molecules we usually want to calculate the properties of one isolated molecule without incurring interactions between the molecule and its periodic images. JDFTx can eliminate image interactions in general geometries, for molecules, nanowires, slabs etc. using truncated Coulomb potentials. (See command <a class="el" href="CommandCoulombInteraction.html">coulomb-interaction</a>.) This tutorial shows you the most convenient and efficient way to set up molecule calculations, starting from molecule geometries in the XYZ format, often used by the chemistry community.</p>
<p>Let's stick to water, but this time fetch the geometry from the <a href="http://cccbdb.nist.gov">NIST CCCBDB</a> database. Picking one of the many calculated geometries of water from that database, we can create water.xyz containing: </p>
<pre class="fragment">3

O    0  0        0.127118
H    0  0.75799 -0.50847
H    0 -0.75799 -0.50847
</pre><p>The first line is the number of atoms, the second line is a comment line that is ignored, and the subsequent lines specify the atom type and cartesian coordinates in Angstroms.</p>
<p>Now, we can use the script xyzToIonposOpt from the JDFTx scripts directory to convert this to JDFTx input (see <a class="el" href="GettingStarted.html">Getting started</a> to add this directory to your run PATH, or specify full path to script below): </p>
<pre class="fragment">xyzToIonposOpt water.xyz 15
</pre><p>This script outputs ionic positions in water.ionpos and lattice vectors in water.lattice after centering the molecule at the origin and rotating it such that you can use the smallest box with a periodic image distance of 10 bohrs. Using these outputs, we can create the input file water.in: </p>
<pre class="fragment">include water.lattice
include water.ionpos
coords-type cartesian

ion-species GBRV/$ID_pbe_v1.2.uspp   #Replace $ID by any atom symbol to find a pseudopotential
ion-species GBRV/$ID_pbe_v1.01.uspp  #If not found in previous pattern, search with this pattern
ion-species GBRV/$ID_pbe_v1.uspp     #If not found in previous patterns, search with this pattern
elec-cutoff 20 100                   #Recommended cutoffs for GBRV pseudopotentials
dump End None                        #Don't output anything for this example
</pre><p>which we can run as </p>
<pre class="fragment">jdftx -i water.in | tee water.out
</pre><p>In this input file, we specified the entire set of GBRV pseudopotentials using the wildcard syntax of command <a class="el" href="CommandIonSpecies.html">ion-species</a> instead of selecting O and H pseudopotentials specifically. Therefore, we could replace water with another molecule containing other atom types with almost no change to the input file, making it extremely easy to set up similar calculations for a large number of molecules. Now, check the final energy of the water molecule (in Hartrees) using the script: </p>
<pre class="fragment">listEnergy water.out
</pre><p>Next, check how the energy changes upon increasing the box size. Replace 15 with 20, 25 and then 30 in xyzToIonposOpt above, and rerun jdftx and listEnergy for each. You could do this manually, but could easily script all these calculations in the bash shell and retrieve their energies using: </p>
<pre class="fragment">#!/bin/bash
for padding in 15 20 25 30; do
    xyzToIonposOpt water.xyz $padding
    jdftx -i water.in | tee water-$padding.out
done
listEnergy water-*.out
</pre><p>Note that you could directly type the above in the shell, or save them to a file, say run.sh, give execute permissions using chmod +x run.sh and then execute using ./run.sh</p>
<p>Finally, also add the coulomb trunaction commands to the above water.in: </p>
<pre class="fragment">coulomb-interaction Isolated         #Switch from periodic to isolated images mode
coulomb-truncation-embed 0 0 0       #Center of molecule; origin for breaking periodicity
</pre><p>and once again run the calculation for the four box sizes.</p>
<p>I get the following energies with and without Coulomb truncation for the different box sizes:</p>
<table class="doxtable">
<tr>
<th>Padding </th><th>Without truncation </th><th>With truncation  </th></tr>
<tr>
<td>15 </td><td>-17.268222645781691 </td><td>-17.268003657134862 </td></tr>
<tr>
<td>20 </td><td>-17.268147969097498 </td><td>-17.268041483330446 </td></tr>
<tr>
<td>25 </td><td>-17.268101327860506 </td><td>-17.268042627595506 </td></tr>
<tr>
<td>30 </td><td>-17.268079759393924 </td><td>-17.268044242680695 </td></tr>
</table>
<p>Note that the energy converges much faster with box size after including truncation. In fact, with truncation, the energy converges exponentially with unit cell size, compared to an inverse-cubic convergence without truncation due to dipole-dipole interactions.</p>
<p>In this example, the energy with 15 bohr spacing with Coulomb truncation is within 5x10<sup>-5</sup> Hartrees of the value converged with box size, whereas only with a 30 bohr spacing achieves that accuracy without truncation. Also note that the calculation with the 30 bohr spacing is roughly 8 times slower than that with the 15 bohr spacing, so using optimized unit cells with truncated Coulomb interactions can substantially speed up your calculation. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
