<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>JDFTx: Parallelization utilities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.2.1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__parallel.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Parallelization utilities</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:Thread_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="Thread_8h.html">Thread.h</a></td></tr>
<tr class="memdesc:Thread_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utilities for threading (wrappers around std::thread) <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAutoThreadCount.html">AutoThreadCount</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maintain thread timing statistics and automatically choose the optimum number of threads.  <a href="classAutoThreadCount.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae05949d6e64da0df9c924ee4a20a1935"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__parallel.html#gae05949d6e64da0df9c924ee4a20a1935">shouldThreadOperators</a> ()</td></tr>
<tr class="separator:gae05949d6e64da0df9c924ee4a20a1935"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga584bbfb44fcc16e6ef0d533539e40b77"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga584bbfb44fcc16e6ef0d533539e40b77"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__parallel.html#ga584bbfb44fcc16e6ef0d533539e40b77">suspendOperatorThreading</a> ()</td></tr>
<tr class="memdesc:ga584bbfb44fcc16e6ef0d533539e40b77"><td class="mdescLeft">&#160;</td><td class="mdescRight">call from multi-threaded top-level code to disable threading within operators called from a parallel section <br/></td></tr>
<tr class="separator:ga584bbfb44fcc16e6ef0d533539e40b77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0579e267e9b37069145013bb7e309064"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0579e267e9b37069145013bb7e309064"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__parallel.html#ga0579e267e9b37069145013bb7e309064">resumeOperatorThreading</a> ()</td></tr>
<tr class="memdesc:ga0579e267e9b37069145013bb7e309064"><td class="mdescLeft">&#160;</td><td class="mdescRight">call after a parallel section in top-level code to resume threading within subsequent operator calls <br/></td></tr>
<tr class="separator:ga0579e267e9b37069145013bb7e309064"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa90e7f5ea531ff4130ef6b8c5227599c"><td class="memTemplParams" colspan="2">template&lt;typename Callable , typename... Args&gt; </td></tr>
<tr class="memitem:gaa90e7f5ea531ff4130ef6b8c5227599c"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__parallel.html#gaa90e7f5ea531ff4130ef6b8c5227599c">threadLaunch</a> (int nThreads, Callable *func, size_t nJobs, Args...args)</td></tr>
<tr class="memdesc:gaa90e7f5ea531ff4130ef6b8c5227599c"><td class="mdescLeft">&#160;</td><td class="mdescRight">A simple utility for running muliple threads.  <a href="#gaa90e7f5ea531ff4130ef6b8c5227599c">More...</a><br/></td></tr>
<tr class="separator:gaa90e7f5ea531ff4130ef6b8c5227599c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaafbcc2af39da32d567705fae228ba7ba"><td class="memTemplParams" colspan="2">template&lt;typename Callable , typename... Args&gt; </td></tr>
<tr class="memitem:gaafbcc2af39da32d567705fae228ba7ba"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__parallel.html#gaafbcc2af39da32d567705fae228ba7ba">threadLaunch</a> (Callable *func, size_t nJobs, Args...args)</td></tr>
<tr class="separator:gaafbcc2af39da32d567705fae228ba7ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad9626870f1866cf08591b31a50776731"><td class="memTemplParams" colspan="2">template&lt;typename Callable , typename... Args&gt; </td></tr>
<tr class="memitem:gad9626870f1866cf08591b31a50776731"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__parallel.html#gad9626870f1866cf08591b31a50776731">threadLaunch</a> (<a class="el" href="classAutoThreadCount.html">AutoThreadCount</a> *, Callable *func, size_t nJobs, Args...args)</td></tr>
<tr class="separator:gad9626870f1866cf08591b31a50776731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaec6197210013eea976e5afa2346075a2"><td class="memTemplParams" colspan="2">template&lt;typename Callable , typename... Args&gt; </td></tr>
<tr class="memitem:gaec6197210013eea976e5afa2346075a2"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__parallel.html#gaec6197210013eea976e5afa2346075a2">threadedLoop</a> (Callable *func, size_t nIter, Args...args)</td></tr>
<tr class="memdesc:gaec6197210013eea976e5afa2346075a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">A parallelized loop.  <a href="#gaec6197210013eea976e5afa2346075a2">More...</a><br/></td></tr>
<tr class="separator:gaec6197210013eea976e5afa2346075a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacd3e4ee4aa4c2a6b734065a8ac0bbafb"><td class="memTemplParams" colspan="2">template&lt;typename Callable , typename... Args&gt; </td></tr>
<tr class="memitem:gacd3e4ee4aa4c2a6b734065a8ac0bbafb"><td class="memTemplItemLeft" align="right" valign="top">double&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__parallel.html#gacd3e4ee4aa4c2a6b734065a8ac0bbafb">threadedAccumulate</a> (Callable *func, size_t nIter, Args...args)</td></tr>
<tr class="memdesc:gacd3e4ee4aa4c2a6b734065a8ac0bbafb"><td class="mdescLeft">&#160;</td><td class="mdescRight">A parallelized loop with an accumulated return value.  <a href="#gacd3e4ee4aa4c2a6b734065a8ac0bbafb">More...</a><br/></td></tr>
<tr class="separator:gacd3e4ee4aa4c2a6b734065a8ac0bbafb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga08f23ff704a488738a9741bde7feab45"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga08f23ff704a488738a9741bde7feab45"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__parallel.html#ga08f23ff704a488738a9741bde7feab45">nProcsAvailable</a></td></tr>
<tr class="memdesc:ga08f23ff704a488738a9741bde7feab45"><td class="mdescLeft">&#160;</td><td class="mdescRight">number of available processors (initialized to number of online processors, can be overriden) <br/></td></tr>
<tr class="separator:ga08f23ff704a488738a9741bde7feab45"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gae05949d6e64da0df9c924ee4a20a1935"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool shouldThreadOperators </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Operators should run multithreaded if this returns true, and should run in a single thread if this returns false. Note that all the thread launching functions in this file automatically prevent nested threading, so operator codes using those functions need not explicitly check this.</p>
<p>This only affects CPU threading, GPU operators should only be called from a single thread anyway. </p>

</div>
</div>
<a class="anchor" id="gacd3e4ee4aa4c2a6b734065a8ac0bbafb"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Callable , typename... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">double threadedAccumulate </td>
          <td>(</td>
          <td class="paramtype">Callable *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nIter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A parallelized loop with an accumulated return value. </p>
<p>Same as <a class="el" href="group__parallel.html#gaec6197210013eea976e5afa2346075a2" title="A parallelized loop. ">threadedLoop</a>, but func() returns double, which is summed over and returned </p>
<dl class="section return"><dt>Returns</dt><dd>Accumulated return value of all calls to func() </dd></dl>

</div>
</div>
<a class="anchor" id="gaec6197210013eea976e5afa2346075a2"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Callable , typename... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void threadedLoop </td>
          <td>(</td>
          <td class="paramtype">Callable *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nIter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A parallelized loop. </p>
<p>Given a callable object func and an argument list args, this routine calls func(i, args) for each i in [0:nIter-1], and accumulates the return values.</p>
<p>Note that the calls are made from multiple threads, so func must be thread safe. (Hint: pass mutexes as a part of args if synchronization is required).</p>
<p>As many threads as online processors are launched and the nIter iterations are evenly split between all the threads. Threaded loops will become single threaded if <a class="el" href="group__parallel.html#ga584bbfb44fcc16e6ef0d533539e40b77" title="call from multi-threaded top-level code to disable threading within operators called from a parallel ...">suspendOperatorThreading()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">func</td><td>The function / object with operator() to be looped over </td></tr>
    <tr><td class="paramname">nIter</td><td>The number of loop 'iterations' </td></tr>
    <tr><td class="paramname">args</td><td>Arguments to pass to func </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaa90e7f5ea531ff4130ef6b8c5227599c"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Callable , typename... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void threadLaunch </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nThreads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Callable *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nJobs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A simple utility for running muliple threads. </p>
<p>Given a callable object func and an argument list args, this routine calls nThreads threads of func invoked as func(iMin, iMax, args). The nJobs jobs are evenly split between all the threads; each instance of func should handle job index i satisfying iMin &lt;= i &lt; iMax.</p>
<p>If nJobs &lt;= 0, the behaviour changes: the function is invoked as func(iThread, nThreads, args) instead, where 0 &lt;= iThread &lt; nThreads. This mode allows for more flexible threading than the evenly split job management indicated above. This could be used as a convenient interface for launching threads for any parallel routine requiring as many threads as processors.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nThreads</td><td>Number of threads to launch (if &lt;=0, as many as processors on system) </td></tr>
    <tr><td class="paramname">func</td><td>The function / object with operator() to invoke in a multithreaded fashion </td></tr>
    <tr><td class="paramname">nJobs</td><td>The number of jobs to be split between the various func threads </td></tr>
    <tr><td class="paramname">args</td><td>Arguments to pass to func </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaafbcc2af39da32d567705fae228ba7ba"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Callable , typename... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void threadLaunch </td>
          <td>(</td>
          <td class="paramtype">Callable *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nJobs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Same as threadLaunch(int nThreads, Callable* func, size_t nJobs, Args... args) with nThreads = number of online processors. </p>

</div>
</div>
<a class="anchor" id="gad9626870f1866cf08591b31a50776731"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Callable , typename... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void threadLaunch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classAutoThreadCount.html">AutoThreadCount</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Callable *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nJobs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Same as threadLaunch(int nThreads, Callable* func, size_t nJobs, Args... args) but with nThreads automatically adjusted over multiple runs using an <a class="el" href="classAutoThreadCount.html" title="Maintain thread timing statistics and automatically choose the optimum number of threads. ">AutoThreadCount</a> object If the <a class="el" href="classAutoThreadCount.html" title="Maintain thread timing statistics and automatically choose the optimum number of threads. ">AutoThreadCount</a> pointer is null, as many threads as processors will be launched </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jun 17 2017 13:44:41 for JDFTx by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
