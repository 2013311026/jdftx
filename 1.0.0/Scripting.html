<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>JDFTx: Scripting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Scripting.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Scripting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>JDFTx was designed with power users in mind and is packed with many neat features that make scripting complex sets of calculations really easy. Here we'll discover the flexibility of JDFTx by measuring elasticity (of a solid, not the code).</p>
<p>All previous examples used -i and -o to read commands from an input file and log to an output file respectively; one or both of these options may be omitted so that JDFTx reads from stdin and/or logs to stdout, allowing the program to be executed in a pipe.</p>
<p>We can combine this with the <a href="http://tldp.org/LDP/abs/html/here-docs.html">here document</a> feature of bash to extract the energy vs. strain curve of bulk Pt with a very simple script (that never writes anything to disk): </p><pre class="fragment">#!/bin/bash
JDFTx=/path/to/jdftx  #Reminder: aliases don't work in scripts

#Loop over strains from -5% to +5%
for aScale in {95..105}; do

    #Compute a/2 in bohrs for the stretched lattice:
    aBy2=$(echo "scale=6; 3.92*$aScale*0.5/(100*0.5291772)" | bc)

    #Print the strain in percent as the first column:
    echo -n $((aScale-100)), " "

    #Run JDFTx to compute the energy (with input from a here document)
    #and use awk to extract and report the final energy from the log
    $JDFTx &lt;&lt;EOF | awk '$1=="IonicMinimize:" &amp;&amp; $4=="F:" {print $5}'
        lattice \
            0.000 $aBy2 $aBy2 \
            $aBy2 0.000 $aBy2 \
            $aBy2 $aBy2 0.000
        ion-species Pt.fhi
        ion Pt 0 0 0  0

        kpoint-folding 4 4 4
        kpoint .5 .5 .5  1

        elec-ex-corr gga-pbe
        dump End None

        elec-n-bands 12
        elec-fermi-fillings 0 0.01
EOF
done
</pre><p>which produces output similar to: </p><pre class="fragment">-5  -2.669861355551623e+01
-4  -2.670472797610590e+01
-3  -2.670945662690582e+01
-2  -2.671274947286359e+01
-1  -2.671494598649965e+01
0  -2.671607957671839e+01
1  -2.671635927342334e+01
2  -2.671578666995583e+01
3  -2.671458307389652e+01
4  -2.671277432086174e+01
5  -2.671053667426573e+01
</pre><p>We can achieve the same using another feature: variable substitution in the input file. Create an input file BulkPt.in with: </p><pre class="fragment">:::bash
lattice \
    0.00000 ${aBy2} ${aBy2} \
    ${aBy2} 0.00000 ${aBy2} \
    ${aBy2} ${aBy2} 0.00000
ion-species Pt.fhi
ion Pt 0 0 0  0

kpoint-folding 4 4 4
kpoint .5 .5 .5  1

elec-ex-corr gga-pbe
dump End None

elec-n-bands 12
elec-fermi-fillings 0 0.01
</pre><p>and then the following bash script prints the energy vs strain curve: </p><pre class="fragment">#!/bin/bash
JDFTx=/path/to/jdftx  #Reminder: aliases don't work in scripts

#Loop over strains from -5% to +5%
for aScale in {95..105}; do

    #Compute a/2 in bohrs for the stretched lattice
    #Note that export makes this variable visible to child process jdftx
    export aBy2=$(echo "scale=6; 3.92*$aScale*0.5/(100*0.5291772)" | bc)

    #Print the strain in percent as the first column:
    echo -n $((aScale-100)), " "

    $JDFTx -i BulkPt.in | awk '$1=="IonicMinimize:" &amp;&amp; $4=="F:" {print $5}'
done
</pre><p>Of course for this example, the first method is more elegant. The real power of this variable substitution lies in the fact that it happens before include commands are processed - this means that the input files can be dynamic by including different files depending on the environment! </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Jan 26 2017 13:05:55 for JDFTx by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
