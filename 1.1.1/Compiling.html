<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>JDFTx: Downloading/Compiling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="jdftx-55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JDFTx
   &#160;<span id="projectnumber">1.1.1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Compiling.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Downloading/Compiling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Download </h2>
<p>Please download the latest JDFTx source tarball from <a href="https://sf.net/projects/jdftx/files/">SourceForge</a>. Unpack the downloaded file using (replacing the version numbers X, Y, Z below as appropriate): </p><pre class="fragment">   tar xvpzf jdftx.X.Y.Z.tar.gz
</pre><p>This will create a sub-directory jdftx containing all the source files. To update the code, download a newer tarball and follow the usual compilation instructions.</p>
<p>Alternatively, if you need a recent update or wish to contribute changes, get the latest development version using one of </p><pre class="fragment">   git clone http://git.code.sf.net/p/jdftx/git jdftx-git
   git clone https://&lt;user&gt;@git.code.sf.net/p/jdftx/git jdftx-git
</pre><p>The first anonymous version will get you the full development tree, but you will not be able to push changes back to the server. For contributing changes, use the second authenticated version and contact us with your sourceforge user name so that we can give you write permissions. This will produce a directory jdftx-git, with a subdirectory jdftx containing all the source files. You can subsequently use <b>git pull</b> from within the jdftx-git directory to fetch latest changes from the repository. See the <a href="http://git-scm.com/documentation">git documentation</a> for more details.</p>
<h2>Bugs / Feature requests </h2>
<p>Please report any bugs on the <a href="http://sf.net/p/jdftx/tickets">tickets page</a>. Include program version (output of <b>jdftx -v</b>), input file and stack-trace (if jdftx produces one on exit).</p>
<p>Feature requests/suggetsions are also welcome.</p>
<p>Please check existing open tickets for similar bugs/requests and if there is one, post there instead of creating a new ticket.</p>
<h2>Compiling </h2>
<p>JDFTx is written to take advantage of the code readability and memory management enhancements of C++11, and hence requires a recent C++ compiler (works on g++4.6). The following programs should be installed before compilation (using ubuntu package names for definiteness):</p>
<ul>
<li>cmake (&gt;=2.8)</li>
<li>g++ (&gt;=4.6)</li>
<li>libgsl0-dev</li>
<li>libopenmpi-dev (or equivalent for other MPI distributions)</li>
<li>libfftw3-dev</li>
<li>libatlas-base-dev (provides blas and cblas)</li>
<li>liblapack-dev</li>
</ul>
<p>If any of these packages are installed in non-standard locations, add the path to those installations by adding <b>-D &lt;package&gt;_PATH=/path/to/package</b> to the cmake command-line, where &lt;package&gt; is FFTW3, GSL etc. Note that cmake command-line options must be specified before the source path (i.e. between cmake and ../jdftx in the examples below).</p>
<p>FFT, BLAS and LAPACK may be provided by Intel's Math Kernel Library (MKL) instead. In that case, the last three packages of the above list are not required. To use MKL, add <b>-D EnableMKL=yes</b> to the command-line. If MKL is not installed to the default path of /opt/intel/mkl, then also add -D MKL_PATH=/path/to/mkl.</p>
<p>Additionally, you can use MKL to provide BLAS and LAPACK, but still use FFTW for Fourier transforms, by adding <b>-D ForceFFTW=yes</b> to the cmake command line. We find this option to often be more reliable than using the MKL FFTs.</p>
<p>The following optional packages are recommended:</p>
<ul>
<li>doxygen (enables offline documentation generation using <b>make doc</b>)</li>
<li><a href="http://www.tddft.org/programs/octopus/wiki/index.php/Libxc">LibXC</a> (for additional exchange-correlation functionals. Works with LibXC version 2.0; add -D EnableLibXC=yes and if necessary -D LIBXC_PATH=/path/to/libxc during compilation)</li>
</ul>
<p>For GPU support, install the <a href="http://developer.nvidia.com/cuda-toolkit">CUDA SDK</a> (version 4.0 or higher) and add <b>-D EnableCUDA=yes</b> to the cmake commandline below to compile JDFTx with CUDA support. If you get an unsupported compiler error, comment out the GCC version check from $CUDA_DIR/include/host_config.h.</p>
<p>If you want to run on a GPU, it must be a discrete (not on-board) NVIDIA GPU with compute capability &gt;= 1.3, since that is the minimum for double precision. Also, you will get a real speedup only if your device has a higher memory bandwidth than your CPU/motherboard/RAM combination, since plane-wave DFT is often a memory-bound computation. See <a href="https://developer.nvidia.com/cuda-gpus">https://developer.nvidia.com/cuda-gpus</a> for compute capabilities of various GPUs. Finally, keep in mind that you also need a lot of memory on the GPU to actually fit systems of reasonable size (you probably need at least 1-2 GB of GRAM to handle moderate-sized systems).</p>
<p>With the above packages installed, issue the following sequence of commands to build jdftx. This assumes that you unpacked the source tarball in the current directory &lt;path-to-JDFTx&gt; (so that a subdirectory jdftx contains the source). Adjust the path to the jdftx source directory, as appropriate. For example, if you used git as indicated above, it will be ../jdftx-git/jdftx isntead. </p><pre class="fragment">&lt;path-to-JDFTx&gt;$ mkdir build
&lt;path-to-JDFTx&gt;$ cd build
&lt;path-to-JDFTx&gt;/build$ cmake [insert options here] ../jdftx
&lt;path-to-JDFTx&gt;/build$ make
</pre><p>A successful build will produce an executable jdftx in &lt;path-to-JDFTx&gt;/build, and an additional executable jdftx_gpu if cmake was configured with EnableCUDA=yes.</p>
<p>To update your copy of jdftx, either download and extract a newer tarball, or <b>git pull</b> in the source directory. Make sure you rerun cmake in the build directory: this is required to include any newly added source files to the build.</p>
<p>The above commands use the default compiler (typically g++) and reasonable optimization flags. JDFTx has also been tested with Intel C++ compiler version 13. You can select the intel compiler during configuration: </p><pre class="fragment">&lt;path-to-JDFTx&gt;/build$ CC=icc CXX=icpc cmake [insert options here] ../jdftx
</pre><p>Make sure the environment variables for the intel compiler (path settings etc.) are loaded before issuing that command (see the compiler documentation / install notes). Of course, you would probably include -D EnableMKL=yes in the options to use Intel MKL.</p>
<p>At the default optimization level, the compiled executable is not locked to specific CPU features. You can enable machine specific optimizations (-march=native on gcc, -fast on icc) by adding "-D CompileNative=yes" to the cmake command-line option list. Note however that this might cause your executable to be usable only on mahcines with CPUs of the same or newer generation than the machine it was compiled on.</p>
<h2>Compiling on TACC Stampede </h2>
<p>Use the GNU compilers and MKL for the easiest compilation on Stampede. Assuming that the source is in ../jdftx and that the shell is bash, you can configure the JDFTx build as follows. </p><pre class="fragment">#Select gcc as the compiler:
module load gcc/4.7.1
module load mkl gsl cuda cmake

#Configure:
CC=gcc CXX=g++ cmake \
   -D EnableCUDA=yes \
   -D EnableMKL=yes \
   -D MKL_PATH="$TACC_MKL_DIR" \
   -D GSL_PATH="$TACC_GSL_DIR" \
   ../jdftx

make -j12
</pre><p>Make on the login nodes (as shown above) or on the gpu queue if you loaded cuda; it should work on any machine otherwise.</p>
<h2>Compiling on NERSC </h2>
<p>Use the gnu compiler and MKL to compile JDFTx on NERSC edison/cori. The following commands may be used to invoke cmake: </p><pre class="fragment">#Select the right compiler and load necessary modules
module swap PrgEnv-intel PrgEnv-gnu
module load gcc cmake gsl fftw mkl
module unload darshan

#From inside your build directory
#(assuming relative paths as in the generic instructions above)
CC="cc -dynamic -lmpich" CXX="CC -dynamic -lmpich" cmake \
    -D EnableProfiling=yes \
    -D EnableMKL=yes \
    -D ForceFFTW=yes \
    -D MKL_PATH=${MKL_HOME} \
    -D GSL_PATH=${GSL_DIR} \
    -D FFTW3_PATH=${FFTW_DIR} \
    -D CMAKE_INCLUDE_PATH=${FFTW_INC} \
    ../jdftx
make -j12</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Jan 26 2017 12:58:06 for JDFTx by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
